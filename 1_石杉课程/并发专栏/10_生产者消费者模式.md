# 生产者消费者模式

## 概念

### 结构

> 生产者：生产任务的线程；
>
> 消费者：处理任务的线程；
>
> 任务队列：channel，生产者将任务提交放入，消费者从中取出处理任务。

![image-20210630210034623](https://i.loli.net/2021/06/30/KX6lIVOd1ETJSvj.png)

###### 伪代码

```java
public static void main(String[] args) {

    BlockingQueue<String> queue = new ArrayBlockingQueue<>(10);

    ExecutorService productThread = Executors.newFixedThreadPool(3);
    ExecutorService customerThread = Executors.newFixedThreadPool(2);

    productThread.submit(() -> {
        System.out.println("生产消息");
        String msgBody = "消息";
        try {
            queue.put(msgBody);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    });

    customerThread.submit(() -> {
        System.out.println("消费消息");
        try {
            String msg = queue.take();
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    });
}
```

## 优点

- **生产者和消费者解耦**：生产者不需要阻塞等待消费者处理完任务应答；消费者只需要处理任务即可，无需关心消息如何产生的。
- **异步处理**：生产者不需要同步等待消费者处理完任务。
- **消除生产者和消费者之间运行效率的差异**：
  - 生产者产生任务的速度>消费者处理任务的速度，由于任务队列的存在，可以作为一个`缓冲区`来弥补这个速度差。
  - 生产者产生任务的速度<消费者处理任务的速度，可以通过减少消费者线程数量，减少系统线程切换和线程本身所带来的负载。

